-- source include/have_sequoiadb.inc
#
# (Case #15395)
#
CREATE TABLE t1 (word varchar(1000) NOT NULL, PRIMARY KEY (word))engine=sequoiadb;
show create table t1;
insert into t1 values(repeat('a',960));
insert into t1 values(repeat('b',960));
insert into t1 values(repeat('c',960));
select * from t1 where word=repeat('a',960);
alter table t1 drop primary key;
show create table t1;
alter table t1 add primary key(word);
show create table t1;
select * from t1 where word=repeat('a',960);
drop table t1;

--error ER_TOO_LONG_KEY
CREATE TABLE t1 (word varchar(1001) NOT NULL, PRIMARY KEY (word))engine=sequoiadb;

#
# (Case #15395)
#
CREATE TABLE t1 (word text NOT NULL, KEY (word(1000)))engine=sequoiadb;
show create table t1;
insert into t1 values(repeat('a',960));
insert into t1 values(repeat('b',960));
insert into t1 values(repeat('c',960));
select * from t1 where word=repeat('a',960);
alter table t1 drop key word;
show create table t1;
alter table t1 add key(word(1000));
show create table t1;
select * from t1 where word=repeat('a',960);
drop index word on t1;
show create table t1;
create index word on t1(word(1000));
show create table t1;
select * from t1 where word=repeat('a',960);
drop index word on t1;
--error ER_TOO_LONG_KEY
create index word on t1(word(1001));
drop table t1;

--error ER_TOO_LONG_KEY
CREATE TABLE t1 (word text NOT NULL, KEY (word(1001)))engine=sequoiadb;
--error ER_TOO_LONG_KEY
CREATE TABLE t1 (a char,b varchar(1000),KEY (a,b))engine=sequoiadb;

--source include/uninstall_sequoiadb.inc
